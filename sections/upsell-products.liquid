{%- liquid
  assign cart_product_ids = cart.items | map: 'product_id'
  assign test_products = collections['aneis'].products | where: "available", true
  assign filtered_products = test_products | reject: "id", cart_product_ids
  assign max_products_to_display = 3
  assign displayed_products_count = 0
  assign random_seed = 'now' | date: '%s' | modulo: 1000
  assign product_count = filtered_products.size
-%}

{% if cart.item_count > 0 and product_count > 0 %}
<section>
  <h3>Você também pode gostar</h3>
  <div class="upsell-products-grid">
    {% for i in (0..product_count) %}
      {%- liquid
        if displayed_products_count >= max_products_to_display
          break
        endif

        assign index = random_seed | plus: i | modulo: product_count
        assign upsell_product = filtered_products[index]

        assign displayed_products_count = displayed_products_count | plus: 1
      -%}

      <div>
        <p>{{ upsell_product.title }}</p>
        <p>{{ upsell_product.price | money }}</p>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}


{% schema %}
{
  "name": "Upsell no Carrinho",
  "settings": [
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Coleção 1"
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Coleção 2"
    },
    {
      "type": "collection",
      "id": "collection_3",
      "label": "Coleção 3"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Quantidade de produtos",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 3
    },
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "Você também pode gostar"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtítulo",
      "default": "Produtos recomendados para você"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto do botão",
      "default": "Adicionar ao Carrinho"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Cor de fundo do botão",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Cor do texto do botão",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "font_family",
      "label": "Fonte",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "Padrão do tema" },
        { "value": "Arial, sans-serif", "label": "Arial" },
        { "value": "'Helvetica Neue', sans-serif", "label": "Helvetica Neue" },
        { "value": "'Times New Roman', serif", "label": "Times New Roman" },
        { "value": "'Courier New', monospace", "label": "Courier New" }
      ]
    }
  ]
}
{% endschema %}
